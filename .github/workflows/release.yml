name: Debug Release Build

on:
  push:
    tags:
      - 'v*.*.*'

jobs:
  debug_build_environment:
    name: Debug Build Environment
    runs-on: ubuntu-latest
        
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Display pyproject.toml Content
        run: |
          echo "--- Contents of pyproject.toml ---"
          cat pyproject.toml
          echo "------------------------------------"

      - name: List All Files in Repository
        # ✅ This will show us if any other config files (like setup.cfg) exist
        run: |
          echo "--- Listing all files in the repository ---"
          ls -laR
          echo "-------------------------------------------"

      - name: Install build tools
        run: pip install build twine

      - name: Build sdist (Source Distribution)
        # We build only the sdist to inspect the metadata it generates
        run: python -m build --sdist

      - name: Inspect sdist metadata (PKG-INFO)
        # ✅ This is the most important step. It shows us the EXACT metadata
        # that setuptools created, which is what PyPI is rejecting.
        run: |
          echo "--- Unpacking the sdist to inspect metadata ---"
          tar -xvf dist/*.tar.gz
          echo "--- Contents of the generated PKG-INFO file ---"
          # The PKG-INFO file is inside the .egg-info directory of the unpacked sdist
          cat fasttext_community-*/fasttext_community.egg-info/PKG-INFO
          echo "-------------------------------------------------"